<! - Exemplo Webphone com interface própria ou oculto ->
< html >
    < corpo >
        < div  id = " widget-evoline-api-container " style = " display: inline " width = " 10 " height = " 20 " > </ div >
        < script  src = " https://code.jquery.com/jquery-3.1.0.min.js " >
        </ script >
        < script >
            // todas as mensagens oriundas do webphone são recebidas aqui.
            janela . onmessage  =  function ( e )  {
                // quando receber uma ligacao
                se  ( e . de dados . mensagem  ==  'chegandoChamada' )  {
                    alert ( 'Chegando Chamada de'  +  e . data . numeroChegando  +  'para:'  +  e . data . numeroDestino  +  'chamada_recebida_id:'  +  e . data . chamadaRecebidaId ) ;
                }
                // conectado, desconectado, chamando, encerrada, conversando
                se  ( e . de dados . mensagem  ==  'status' )  {
                    // alert ('Status:' + e.data.status);
                }
                // o id é único e pode ser usado na api para recuperação de mais informações (get na api ou webhooks) 
                if  ( e . dados . mensagem  ==  'chamada_id' )  {
                    alert ( 'Chamada_id:'  +  e . data . chamada_id ) ;
                }
                // os erros são finais
                se  ( e . de dados . mensagem  ==  'status_erro' )  {
                    // alert ('Sem Permissão:' + e.data.status_erro);
                }
                
                // rebendo o status de diagnóstico de internet e computador para verificar qualidade de ligação
                se  ( e . de dados . mensagem  ==  'stats_webphone' )  {
                    // alert ('Internet:' + e.data.internet + 'e computador:' + e.data.computador);
                }
                se ( e . de dados . mensagem  ==  'pausou_na_fila' )  {
                    // Evento disparado quando o ramal é pausado na fila
                }
                outra  se ( e . de dados . mensagem  ==  'despausou_na_fila' )  {
                    // Evento disparado quando o ramal é despausado na fila
                }
                else  if ( e . data . message  ==  'entrou_na_fila' )  {
                    // Evento disparado quando o ramal entra na fila
                }
                outra  se ( e . de dados . mensagem  ==  'saiu_da_fila' )  {
                    // Evento disparado quando o ramal sai da fila
                }
    
            } ;
    
            // encerra chamada ativa
            function  desligaChamada ( )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'hangup'
                } ,  '*' ) ;
            }
    
            // Conecta o webphone para colocar-lo em operação
            function  conectar ( ) {
                webphone . contentWindow . postMessage ( { message : 'conectar' } ,  '*' ) ;
            }

            // desconecta o webphone - ele nao recebe nem envia mais chamadas
            function  desconectar ( ) {
                webphone . contentWindow . postMessage ( { mensagem : 'desconectar' } ,  '*' ) ;
            }

            
            // telefona para um número
            function  chamaNumero ( numero )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'chamaNumero' ,
                    'numero' : numero
                } ,  '*' ) ;
            }
    
            // atender
            function  atender ( )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'responder'
                } ,  '*' ) ;
            }
    
            // para uso com uras
            function  enviaDTMF ( meuDTMF )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'enviaDTMF' ,
                    'dtmf' : meuDTMF
                } ,  '*' ) ;
            }
    
            // silenciar microfone
            function  mute ( )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'mudo'
                } ,  '*' ) ;
            }
    
            // transferencia blind - encerra a ligação aqui e transfere para o numero
            função  transferir ( numeroTelefone )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'transferir' ,
                    'numeroTelefone' : numeroTelefone
                } ,  '*' ) ;
            }
    
            // transferencia com consulta
            function  transferirConsulta ( numeroTelefone )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'transferirConsulta' ,
                    'numeroTelefone' : numeroTelefone
                } ,  '*' ) ;
            }

            function  recstart ( )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'recStart'
                } ,  '*' ) ;
            }

            function  recstop ( )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'recStop'
                } ,  '*' ) ;
            }

            function  pausarNaFila ( filaId )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'pausarNaFila' ,
                    filaId : filaId
                } ,  '*' ) ;
            }

            function  despausarNaFila ( filaId )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'despausarNaFila' ,
                    filaId : filaId
                } ,  '*' ) ;
            }

            function  entrarNaFila ( filaId )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'entrarNaFila' ,
                    filaId : filaId
                } ,  '*' ) ;
            }

            function  sairDaFila ( filaId )  {
                webphone . contentWindow . postMessage ( {
                    mensagem : 'sairDaFila' ,
                    filaId : filaId
                } ,  '*' ) ;
            }
        </ script >
        <! - URL que foi pega pela API no / webphone - cria o iframe e injeta o webphone ->
        < script  src = " URL_WEBPHONE_API_TOTALVOICE " > </ script >
        
        < Br >
        < Entrada  tipo = " botão " onclick =" javascript: Conectar (); " valor =" Conectar " > (O Sistema Conecta Sozinho POR padrão Ao abrir) < br >
        < Entrada  tipo = " botão " onclick =" javascript: desconectar (); " valor =" desconectar " > (nao recebe NEM Faz Mais chamadas) < br >

        < input  type = " button " onclick = " javascript: desligaChamada (); " value = " Desliga " >
        < input  type = " button " onclick = " javascript: chamaNumero (4001); " value = " Chama 4001 " >
        < Br >
        < input  type = " button " onclick = " javascript: chamaNumero (4832830151); " value = " Chama 4832830151 " >
        < Br >
        < input  type = " button " onclick = " javascript: chamaNumero (97988888888); " value = " Chama 97988888888 " >
        < Br > (DTMF: 0,1,2,3,4,5,6,7,8,9, *, #) < br >
        < input  type = " button " onclick = " javascript: enviaDTMF ('1'); " value = " DTMF 1 " >
        < Br >
        < input  type = " button " onclick = " javascript: enviaDTMF ('2'); " value = " DTMF 2 " >
        < Br >
        < input  type = " button " onclick = " javascript: enviaDTMF ('0'); " value = " DTMF 0 " >
        < Br >
        < input  type = " button " onclick = " javascript: enviaDTMF ('*'); " value = " DTMF * " >
        < Br >
        < input  type = " button " onclick = " javascript: enviaDTMF ('#'); " value = " DTMF # " >
        < Br > < entrada  tipo = " botão " onclick =" javascript: mute (); " valor =" Mudo / Com som " >
        < Br >
        < Br >
        < input  type = " button " onclick = " transferirConsulta ('4000'); " value = " Transferir Consulta para 4998 " >
        < Br >
        < input  type = " button " onclick = " transferir ('4515'); " value = " Transferir para 4515 " >
        < input  type = " button " onclick = " javascript: atender (); " value = " Atender " >

        < Br >
        < Br >

        < input  type = " button " onclick = " javascript: recstart (); " value = " REC Start " >
        < input  type = " button " onclick = " javascript: recstop (); " value = " REC Stop " >

        < Br >
        < Br >
        
        < input  type = " button " onclick = " javascript: pausarNaFila (); " value = " Pausar em todas filas " >
        < input  type = " button " onclick = " javascript: despausarNaFila (); " value = " Despausar em todas filas " >

        < Br >
        < Br >
        
        < input  type = " button " onclick = " javascript: entrarNaFila (47); " value = " Entrar na fila 47 " >
        < input  type = " button " onclick = " javascript: sairDaFila (47); " value = " Sair da fila 47 " >
    </ body >
    
</ html >
